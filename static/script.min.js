let youtubeId,youlagModalNavigatingBack=!1,youlagModalPopstateIgnoreNext=!1,youlagScriptLoaded=!1,youlagNavMenuInitialized=!1,youlagClickListenersInitialized=!1,youlagRestoreVideoQueueRan=!1,youladModalPopstateAdded=!1,youlagActive=!0,youtubeExtensionInstalled=!1,disableStickyTransitionTitle=!1,previousPageTitle=null,previousFeedItemScrollTop=0,modePip=!1,modeFullscreen=!0,feedItemActive=!1;const youlagModalVideoRootIdName="youlagTheaterModal",modalVideoContainerClassName="youlag-theater-modal-container",modalVideoContentClassName="youlag-theater-modal-content",modalCloseIdName="youlagCloseModal",modalMinimizeIdName="youlagMinimizeModal",modalVideoSourceIdName="youlagVideoSource",modalVideoSourceDefaultIdName="youlagVideoSourceDefault",modalToggleFavoriteIdName="youlagToggleFavorite",modalFavoriteClassName="youlag-favorited",modalTagsManageIdName="youlagTagsManage",modalTagsContainerIdName="youlagTagsModal";function youlagSettingsPageEventListeners(){const e=document.getElementById("yl_playback_invidious"),t=document.getElementById("yl_playback_youtube"),o=document.getElementById("yl_invidious_url_1");if(e&&t&&o){function a(){e.checked?o.setAttribute("required","required"):o.removeAttribute("required")}e.addEventListener("change",a),t.addEventListener("change",a),a()}}function handleActiveItemVideoMode(e,t=!1){let o;if(previousFeedItemScrollTop=0,t){const t=e;o={...t.queue[t.activeIndex],queue:t.queue,activeIndex:t.activeIndex}}else{const t=e instanceof Event?e.target.closest("div[data-feed]"):e.closest("div[data-feed]");if(!t)return;o=extractFeedItemData(t),o.feedItemEl=t,setVideoQueue(o)}modePip||setModeFullscreen(!0),createModalVideo(o)}function handleActiveItemArticle(e){history.pushState({articleOpen:!0},"","")}function getVideoIdFromUrl(e){const t=e.match(/(?:\/|^)(?:shorts\/|v\/|e(?:mbed)?\/|\S*?[?&]v=|\S*?[?&]id=|v=)([a-zA-Z0-9_-]{11})(?:[\/\?]|$)/);return t?t[1]:""}function getBaseUrl(e){try{const t=new URL(e);return`${t.protocol}//${t.host}`}catch(e){return console.error("Invalid URL:",e),""}}function matchURL(e){if(!e||"string"!=typeof e)return[];let t=e.replace(/<a [^>]*href=["'][^"']+["'][^>]*>.*?<\/a>/gi,"").match(/https?:\/\/[\w\-._~:/?#\[\]@!$&'()*+,;=%]+[\w\-_/~#@?=&%]/g);return t||[]}function appendUrl(e){if(!e||"string"!=typeof e)return e;let t=/https?:\/\/[\w\-._~:/?#\[\]@!$&'()*+,;=%]+[\w\-_/~#@?=&%]/g,o=e.split(/(<a [^>]*>.*?<\/a>)/gi);for(let e=0;e<o.length;e++)/^<a [^>]*>.*<\/a>$/i.test(o[e])||(o[e]=o[e].replace(t,function(e){return'<a href="'+e+'" target="_blank">'+e+"</a>"}));return o.join("")}function sanitizeExtractedVideoUrl(e){const t=String(e);if(/^https?:\/\//.test(t.trim()))return t.trim();const o=t.match(/href=["']([^"'>]+)["']/);return o&&o[1]?o[1]:""}function extractFeedItemData(e){const t=e.getAttribute("data-entry")?.match(/([0-9]+)$/);let o=e.querySelector('.item.titleAuthorSummaryDate a[href*="youtube"], .item.titleAuthorSummaryDate a[href*="/watch?v="]')?.href||"";o||(o=e.querySelector('.enclosure-content a[href*="youtube"], .enclosure-content a[href*="/watch?v="]'),o=sanitizeExtractedVideoUrl(o),youtubeExtensionInstalled=!!o);const a=""!==o,n=null!==e.querySelector(".enclosure-description"),i=a?getBaseUrl(o):"";youtubeId=o?getVideoIdFromUrl(o):"";const l=youtubeId?`https://www.youtube.com/watch?v=${youtubeId}`:"",s=youtubeId?`https://www.youtube.com/embed/${youtubeId}`:"",r=youtubeId?`${i}/embed/${youtubeId}`:"",c=e.querySelector(".flux_header"),d=c?.querySelector('.website a.item-element[href*="get=f_"]'),u=e.querySelector(".content div.text span[data-yl-invidious-instance]"),g=u?u.getAttribute("data-yl-invidious-instance"):"",m=e.querySelector(".content div.text span[data-yl-video-source-default]"),y=m?m.getAttribute("data-yl-video-source-default"):"";return{entryId:t?t[1]:null,author:c?.getAttribute("data-article-authors")||"",author_filter_url:d?.href||"",favicon:e.querySelector("img.favicon")?.src||"",favorite_toggle_url:e.querySelector("a.item-element.bookmark")?.href||"",favorited:!e.querySelector('.bookmark img[src*="non-starred"]'),thumbnail:e.querySelector(".thumbnail img")?.src||"",title:e.querySelector(".item-element.title")?.childNodes[0].textContent.trim()||"",external_link:e.querySelector(".item-element.title")?.href||"",date:e.querySelector(".flux_content .date")?.textContent.trim()||"",isVideoFeedItem:a,youtubeId:youtubeId,youtube_embed_url:s,video_embed_url:r,video_invidious_instance_1:g||"",video_source_default:y||"youtube",video_description:`<div class="youlag-video-description-content">\n        ${a&&n?appendUrl(e.querySelector(".enclosure-description")?.innerHTML.trim()):e.querySelector("article div.text")?.innerHTML.trim()||""}\n      </div>`,video_youtube_url:l,video_invidious_redirect_url:""+(youtubeId?"https://redirect.invidious.io/watch?v="+youtubeId:"")}}function setVideoQueue(e){let t=[],o=0;try{const e=localStorage.getItem("youlagVideoQueue");if(e){const a=JSON.parse(e);Array.isArray(a.queue)&&(t=a.queue),"number"==typeof a.activeIndex&&(o=a.activeIndex)}}catch(e){}const a=e.entryId,n=t.findIndex(e=>e.entryId===a),i=document.body.classList.contains("youlag-mode--pip");-1===n?(t.push(e),o=t.length-1):(t.splice(n,1),t.push(e),o=t.length-1),localStorage.setItem("youlagVideoQueue",JSON.stringify({queue:t,activeIndex:o,isPipMode:i}))}function clearVideoQueue(){localStorage.removeItem("youlagVideoQueue")}function restoreVideoQueue(){if(youlagRestoreVideoQueueRan)return;youlagRestoreVideoQueueRan=!0;const e=localStorage.getItem("youlagVideoQueue");let t=null;if(e)try{t=JSON.parse(e)}catch(e){console.error("Error parsing youlagVideoQueue from localStorage:",e)}if(!t||!0!==t.isPipMode)return;const o=document.body.classList;["yl-page-home","yl-page-important","yl-page-watch_later","yl-page-playlists","yl-page-category"].some(e=>o.contains(e))&&t&&Array.isArray(t.queue)&&"number"==typeof t.activeIndex&&t.queue.length>0&&(setModePip(!0),handleActiveItemVideoMode(t,!0))}function setPageTitle(e){"string"==typeof e&&e.length>0?(null===previousPageTitle&&(previousPageTitle=document.title),document.title=e):null!==previousPageTitle&&(document.title=previousPageTitle,previousPageTitle=null)}function createModalVideo(e){let t=document.getElementById("youlagTheaterModal");t||(t=document.createElement("div"),t.id="youlagTheaterModal",t.innerHTML=`<div class="${modalVideoContainerClassName}"></div>`,document.body.appendChild(t));const o=t.querySelector(`.${modalVideoContainerClassName}`),a=e.video_source_default,n="youtube"===a?"selected":"",i="invidious_1"===a?"selected":"",l=e.video_invidious_instance_1;t.classList.remove("youlag-modal-feed-item--has-thumbnail","youlag-modal-feed-item--no-thumbnail"),e.thumbnail?t.classList.add("youlag-modal-feed-item--has-thumbnail"):t.classList.add("youlag-modal-feed-item--no-thumbnail"),feedItemActive=!0;const s=document.querySelector("#yl_mini_player_swipe_enabled");function r(t){return"invidious_1"===t&&e.video_invidious_instance_1&&e.youtubeId?`${e.video_invidious_instance_1.replace(/\/$/,"")}/embed/${e.youtubeId}`:"youtube"===t?e.youtube_embed_url:""}"true"===s?.getAttribute("data-yl-mini-player-swipe-enabled")&&setupSwipeToPipMode(t);const c=r("invidious_1"===a?"invidious_1":"youtube");setPageTitle(e.title),o.innerHTML=`\n    <div class="${modalVideoContentClassName}">\n\n      <div class="youlag-video-header">\n        <select id="youlagVideoSource" class="${l&&e.isVideoFeedItem?"":"display-none"}">\n          <option value="youtube" ${n}>YouTube</option>\n          <option value="invidious_1" ${i}>Invidious</option>\n        </select>\n\n        <button id="${modalMinimizeIdName}">‚ßâ</button>\n        <button id="${modalCloseIdName}">√ó</button>\n      </div>\n\n      <div class="youlag-video-container">\n        <div class="youlag-thumbnail-container">\n          <img src="${e.thumbnail}" class="youlag-video-thumbnail" />\n        </div>\n        <div class="youlag-iframe-container">\n          <iframe class="youlag-iframe"\n                  src="${c}" frameborder="0" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>\n        </div>\n      </div>\n\n\n      <div class="youlag-video-details">\n\n        <div class="youlag-video-metadata-container">\n          <h2 class="youlag-video-metadata-title">${e.title}</h2>\n          <div class="youlag-video-metadata-panel">\n\n            <section class="youlag-video-author-section">\n              <a class="youlag-video-metadata-favicon-link" href="${e.author_filter_url}">\n                <img src="${e.favicon}" class="youlag-video-metadata-favicon" />\n              </a>\n\n              <div class="yl-flex yl-flex-col">\n                <div class="youlag-video-metadata-author">\n                  <a href="${e.author_filter_url}">${e.author}</a>\n                </div>\n                <div class="youlag-video-metadata-date">${e.date}</div>\n              </div>\n            </section>\n\n            <section class="youlag-video-actions-container">\n              <a href="#" \n                class="yl-video-action-button youlag-favorited youlag-favorited--${e.favorited}"\n                id="youlagToggleFavorite">\n                <div class="youlag-favorited-icon"></div>\n              </a>\n\n              <a href="#" \n                class="yl-video-action-button"\n                id="youlagTagsManage">\n                <img class="icon" src="../themes/icons/label.svg" loading="lazy" alt="üè∑Ô∏è">\n              </a>\n\n              <a class="yl-video-action-button" href="${e.external_link}" target="_blank">\n                <span class="yl-video-action-button__icon">üåê</span><span>Source</span>\n              </a>\n\n              <a class="yl-video-action-button" href="${e.video_youtube_url}" target="_blank">\n                <span class="yl-video-action-button__icon">‚ñ∂Ô∏è</span><span>YouTube</span>\n              </a>\n              <a class="yl-video-action-button" href="${e.video_invidious_redirect_url}" target="_blank">\n                <span class="yl-video-action-button__icon">üì∫</span><span>Invidious</span>\n              </a>\n\n            </section>\n\n          </div>\n\n        </div>\n\n\n\n        <div class="youlag-video-description-container">\n          ${e.video_description}\n        </div>\n        \n      </div>\n\n    </div>\n  `;const d=o.querySelector("#youlagVideoSource"),u=o.querySelector(".youlag-iframe");if(d&&u&&d.addEventListener("change",function(){u.src=r(d.value)}),!e.youtubeId){t.classList.add("youlag-modal-feed-item--text"),document.querySelector(".youlag-iframe-container")&&document.querySelector(".youlag-iframe-container").remove()}o.querySelector(`#${modalCloseIdName}`)?.addEventListener("click",closeModalVideo),o.querySelector(`#${modalMinimizeIdName}`)?.addEventListener("click",togglePipMode),o.querySelector("#youlagToggleFavorite")?.addEventListener("click",t=>{t.preventDefault(),toggleFavorite(e.favorite_toggle_url,o,e.feedItemEl)}),o.querySelector("#youlagTagsManage")?.addEventListener("click",async t=>{t.preventDefault(),createTagsModal(e.entryId,await getItemTags(e.entryId))}),modeFullscreen&&!youladModalPopstateAdded&&(history.pushState({modalOpen:!0},"",""),youladModalPopstateAdded=!0),document.addEventListener("keydown",e=>{"Escape"===e.key&&modeFullscreen&&closeModalVideo()}),window.addEventListener("popstate",function(e){if(youlagModalPopstateIgnoreNext)return youlagModalPopstateIgnoreNext=!1,void(youlagModalNavigatingBack=!1);const t=document.getElementById("youlagTheaterModal");modeFullscreen&&t&&(youlagModalNavigatingBack=!1,closeModalVideo())})}function toggleFavorite(e,t,o){const a=t.querySelector("#youlagToggleFavorite");a&&fetch(e,{method:"GET"}).then(e=>{if(e.ok){const e=a.classList.contains("youlag-favorited--true");if(a.classList.remove(`youlag-favorited--${e}`),a.classList.add(`youlag-favorited--${!e}`),o){const t=o.querySelector(".item-element.bookmark img.icon");e?(o.classList.remove("favorite"),t&&(t.src="../themes/Mapco/icons/non-starred.svg")):(o.classList.add("favorite"),t&&(t.src="../themes/Mapco/icons/starred.svg"))}}else console.error("Failed to toggle favorite status")}).catch(e=>console.error("Error:",e))}function closeModalVideo(){const e=document.getElementById("youlagTheaterModal");e&&e.remove(),youladModalPopstateAdded=!1,youlagModalNavigatingBack||!history.state||!history.state.modalOpen||!modeFullscreen&&modePip?history.replaceState(null,"",location.href):(youlagModalNavigatingBack=!0,youlagModalPopstateIgnoreNext=!0,history.back()),feedItemActive=!1,setModePip(!1),setModeFullscreen(!1),setPageTitle(),clearVideoQueue()}function togglePipMode(){modePip?(setModePip(!1),setModeFullscreen(!0)):(setModePip(!0),setModeFullscreen(!1))}function setModePip(e){const t=document.getElementById("youlagTheaterModal");if(!0===e)t&&(previousFeedItemScrollTop=t.scrollTop),document.body.classList.add("youlag-mode--pip"),modePip=!0,modeFullscreen=!1,t&&t.scrollTo({top:0});else if(!1===e){if(t){let e=!1;const o=()=>{e=!0,t.scrollTo({top:previousFeedItemScrollTop,behavior:"smooth"})};t.addEventListener("transitionend",o,{once:!0}),setTimeout(()=>{e||t.scrollTo({top:previousFeedItemScrollTop,behavior:"smooth"})},500)}document.body.classList.remove("youlag-mode--pip"),modePip=!1}try{const t=localStorage.getItem("youlagVideoQueue");if(t){const o=JSON.parse(t);o.isPipMode=!!e,localStorage.setItem("youlagVideoQueue",JSON.stringify(o))}}catch(e){}}function setModeFullscreen(e){!0===e?(document.body.classList.add("youlag-mode--fullscreen"),document.body.classList.remove("youlag-mode--pip"),modeFullscreen=!0,modePip=!1):!1===e&&(document.body.classList.remove("youlag-mode--fullscreen"),modeFullscreen=!1)}function setupSwipeToPipMode(e){let t=null,o=!1;e.addEventListener("touchstart",function(a){0===e.scrollTop&&1===a.touches.length&&(t=a.touches[0].clientY,o=!1)},{passive:!1}),e.addEventListener("touchmove",function(a){if(null!==t&&0===e.scrollTop&&1===a.touches.length){a.touches[0].clientY-t>0&&(o=!0,a.preventDefault())}},{passive:!1}),e.addEventListener("touchend",function(a){if(null!==t&&o&&1===a.changedTouches.length){a.changedTouches[0].clientY-t>40&&0===e.scrollTop&&togglePipMode(!0)}t=null,o=!1},{passive:!1})}function setupClickListener(){if(youlagClickListenersInitialized)return;const e=document.querySelector("#stream");youlagActive?e&&e.addEventListener("click",e=>{if(e.target.closest("div[data-feed] .flux_header li.manage"))return;if(e.target.closest("div[data-feed] .flux_header li.labels"))return;if(e.target.closest("div[data-feed] .flux_header li.share"))return;if(e.target.closest("div[data-feed] .flux_header li.link"))return;if(e.target.closest('div[data-feed] .flux_header .website a[href^="./?get=f_"]'))return;const t=e.target.closest("div[data-feed]");t&&(handleActiveItemVideoMode(e),setTimeout(()=>{collapseBackgroundFeedItem(t)},100))}):youlagActive||(e&&e.addEventListener("click",function(e){const t=e.target.closest("div[data-feed]");t&&!feedItemActive&&(handleActiveItemArticle(e),feedItemActive=!0);const o=()=>{const e=t.getBoundingClientRect(),o=window.pageYOffset||document.documentElement.scrollTop;let a=0;if(window.getComputedStyle){const e=document.documentElement,t=getComputedStyle(e).getPropertyValue("--yl-topnav-height");a=parseInt(t,10)||0}return e.top+o-a},a=document.getElementsByClassName("yl-freshrss-transition--sticky")[0];disableStickyTransitionTitle=!0,a.classList.remove("sticky-visible"),a.classList.add("sticky-hidden");let n=0;const i=()=>{const e=o();window.scrollTo({top:e});window.setTimeout(()=>{n++;const e=o();Math.abs(window.pageYOffset-e)>2&&n<4?window.requestAnimationFrame(i):setTimeout(()=>{disableStickyTransitionTitle=!1},50)},180)};i()}),window.addEventListener("popstate",function(e){if(!location.hash||location.pathname&&"/"!==location.pathname&&location.pathname!==window.location.pathname)if(modePip)history.back();else{document.querySelector("#stream div[data-feed].active.current")&&closeArticle(e)}}),document.addEventListener("keydown",function(e){if("Escape"===e.key)if(youlagActive){document.getElementById("youlagTheaterModal")&&closeModalVideo()}else if(!youlagActive){document.querySelector("#stream div[data-feed].active.current")&&closeArticle(e)}})),youlagClickListenersInitialized=!0}function closeArticle(e){const t=document.querySelector("#stream div[data-feed].active.current");if(t){t.setAttribute("tabindex","-1"),t.focus({preventScroll:!0}),t.classList.remove("active","current");const o=t.getBoundingClientRect(),a=window.pageYOffset||document.documentElement.scrollTop;let n=0;if(window.getComputedStyle){const e=document.documentElement,t=getComputedStyle(e).getPropertyValue("--yl-topnav-height");t&&(n=parseInt(t.trim(),10)||0)}const i=document.getElementsByClassName("yl-freshrss-transition--sticky")[0];disableStickyTransitionTitle=!0,i.classList.remove("sticky-visible"),i.classList.add("sticky-hidden");const l=o.top+a-n;window.scrollTo({top:Math.max(0,l)}),e?.stopPropagation?.(),setTimeout(()=>{disableStickyTransitionTitle=!1},50);const s=location.pathname+location.search;history.state&&history.state.articleOpen&&location.pathname+location.search===s&&history.back(),feedItemActive=!1}}function setupTagsDropdownOverride(){const e=document.querySelector("#stream");e&&e.addEventListener("click",async function(e){const t=e.target.closest("div[data-feed] .flux_header li.labels"),o=t?t.querySelector("a.dropdown-toggle"):null,a=e.target.closest('.item.labels a.dropdown-toggle[href^="#dropdown-labels-"]');if(o||a){e.preventDefault(),e.stopImmediatePropagation();let n=null,i="([0-9]+)$",l=null;o&&(n=t.querySelector(".dropdown-target")?.id,n=n?n.match(new RegExp(i)):null,n=n?n[1]:null,l=o.closest("li.labels")?.querySelector("img.icon")),a&&(n=a.href,n=n?n.match(new RegExp(i)):null,n=n?n[1]:null,l=a.closest("li.labels, .item.labels")?.querySelector("img.icon"));let s=null;l&&(s=l.src,l.classList.add("loading"),l.src="../themes/icons/spinner.svg");let r=await getItemTags(n);l&&(l.classList.remove("loading"),l.src=s),createTagsModal(n,r)}},!0)}function createTagsModal(e,t){document.getElementById("youlagTagsModal")&&document.getElementById("youlagTagsModal").remove();let o=document.createElement("div");const a=!!document.querySelector("body.youlag-video-labels")?"Save to...":"Tags";o.id="youlagTagsModal",o.classList.add("youlag-tags-modal"),o.innerHTML=`\n    <forms class="yl-tags-content">\n      <h3 class="yl-tags-modal-title">\n        ${a}\n\n        <a href="./?c=tag" target="_blank"><img class="icon" src="../themes/Mapco/icons/configure.svg" loading="lazy" alt="‚öôÔ∏è"></a>\n      </h3>\n      <div class="yl-tags-list">\n        ${t.map(t=>`\n            <div class="yl-tags-list-item">\n              <input type="checkbox" id="yl-tag-${t.id}" data-tag-id="${t.id}" data-entry-id="${e}" ${t.checked?"checked":""} />\n              <label for="yl-tag-${t.id}">${t.name}</label>\n            </div>\n          `).join("")}\n      </div>\n      <div class="yl-tags-modal-actions">\n        <button id="yl-tags-modal-close" class="btn">Done</button>\n      </div>\n    </forms>\n  `,document.body.appendChild(o),document.body.classList.add("youlag-tags-modal-open");function n(){const e=document.getElementById("youlagTagsModal");e&&e.remove(),document.body.classList.remove("youlag-tags-modal-open"),document.removeEventListener("keydown",i,!0)}o.querySelectorAll('.yl-tags-list-item input[type="checkbox"]').forEach(e=>{e.addEventListener("change",function(){const e=this.getAttribute("data-tag-id");setItemTag(this.getAttribute("data-entry-id"),{id:e,checked:this.checked})})});function i(e){"Escape"===e.key&&(n(),e.stopPropagation())}o.querySelector("#yl-tags-modal-close").addEventListener("click",n),document.addEventListener("keydown",i,!0),o.addEventListener("mousedown",function(e){const t=o.querySelector(".yl-tags-content");t&&!t.contains(e.target)&&n()})}async function getItemTags(e){if(!e)return[];const t=`./?c=tag&a=getTagsForEntry&id_entry=${encodeURIComponent(e)}`;try{const e=await fetch(t,{method:"GET"});if(e.ok){const t=await e.json();if(Array.isArray(t))return t}}catch(e){console.error("Error fetching tags:",e)}return[]}async function setItemTag(e,t){const o={_csrf:document.querySelector('input[name="_csrf"]')?.getAttribute("value")||"",id_tag:t.id,name_tag:"",id_entry:e,checked:!!t.checked,ajax:1};try{const e=await fetch("./?c=tag&a=tagEntry&ajax=1",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(o)});if(e.ok){const t=await e.text();if(t&&t.trim().length>0)try{JSON.parse(t)}catch(e){console.error("Error parsing tag update response:",e)}}else console.error("Failed to update tag:",e.status)}catch(e){console.error("Error updating tag:",e)}}function collapseBackgroundFeedItem(e){const t=e;let o=t.classList.contains("active")&&t.classList.contains("current");const a=t.querySelectorAll("iframe");(a||youtubeExtensionInstalled)&&a.forEach(e=>{const t=e.getAttribute("src");t&&(e.setAttribute("data-original",t),e.setAttribute("src",""))}),o&&(t.classList.remove("active"),t.classList.remove("current"))}function getCurrentPage(){const e=window.location.pathname,t=new URLSearchParams(window.location.search);function o(e){return e.split(" ").map(e=>"yl-page-"+e).join(" ")}const a=[{path:"/i/",match:()=>"normal"===t.get("a")&&t.has("search"),className:"search_results"},{path:"/i/",match:()=>!t.has("get")&&!t.has("c"),className:"home"},{path:"/i/",match:()=>"extension"===t.get("c"),className:"extension"},{path:"/i/",match:()=>"i"===t.get("get"),className:"important"},{path:"/i/",match:()=>"s"===t.get("get"),className:"watch_later"},{path:"/i/",match:()=>"T"===t.get("get"),className:"playlists"},{path:"/i/",match:()=>/^t_\d+$/.test(t.get("get")||""),className:()=>`playlists t_${(t.get("get")||"").substring(2)}`},{path:"/i/",match:()=>t.get("get")&&t.get("get").startsWith("c_"),className:()=>`category c_${t.get("get").substring(2)}`},{path:"/i/",match:()=>t.get("get")&&t.get("get").startsWith("f_"),className:()=>{t.get("get").substring(2);return"category"}}];for(const t of a)if(e===t.path&&t.match()){return o("function"==typeof t.className?t.className():t.className)}return""}function getSubpageParentId(e){if(/^t_\d+$/.test(e))return"playlists";if(/^f_\d+$/.test(e)){const e=document.querySelector("#sidebar .tree-folder.category.active");return e&&e.id?e.id:null}return null}function getCategoryWhitelist(){const e=document.querySelector("#yl_category_whitelist");if(!e)return[];const t=e.getAttribute("data-yl-category-whitelist");if(!t)return["all"];const o=t.split(",").map(e=>e.trim()).filter(Boolean);try{localStorage.setItem("youlagCategoryWhitelist",JSON.stringify(o))}catch(e){}return o}function isPageWhitelisted(e,t){if(!Array.isArray(e)||!t)return!1;if(e.includes("all"))return!0;const o=["home","important","watch_later","playlists","search_results"];for(const a of o)if(t===`yl-page-${a}`&&e.includes(a))return!0;if(t.startsWith("yl-page-category")){const o=t.match(/c_(\d+)/);if(o&&e.includes("c_"+o[1]))return!0}const a=new URLSearchParams(window.location.search).get("get");if(a){const t=getSubpageParentId(a);if(t&&e.includes(t))return!0}return!1}function setCategoryWhitelistClass(){let e=[];try{const t=localStorage.getItem("youlagCategoryWhitelist");t&&(e=JSON.parse(t))}catch(e){}const t=getCurrentPage(),o=isPageWhitelisted(e,t);youlagActive=o,document.body.classList.toggle("youlag-active",o),document.body.classList.toggle("youlag-inactive",!o);const a=getCategoryWhitelist(),n=isPageWhitelisted(a,t);if(youlagActive=n,n!==o){document.body.classList.toggle("youlag-active",n),document.body.classList.toggle("youlag-inactive",!n);try{localStorage.setItem("youlagCategoryWhitelist",JSON.stringify(a))}catch(e){}return n}return o}function setVideoLabelsClass(){const e=localStorage.getItem("youlagVideoLabels")||!1,t=document.querySelector("#yl_video_labels");let o;t&&(o=t.getAttribute("data-yl-video-labels")),"true"===o?(document.body.classList.add("youlag-video-labels"),localStorage.setItem("youlagVideoLabels","true")):"false"===o?(document.body.classList.remove("youlag-video-labels"),localStorage.setItem("youlagVideoLabels","false")):"true"===e?document.body.classList.add("youlag-video-labels"):document.body.classList.remove("youlag-video-labels")}function setUnreadBadgeClass(){const e=document.querySelector("#yl_video_unread_badge");let t;e&&(t=e.getAttribute("data-yl-video-unread-badge")),"true"===t?document.body.classList.add("youlag-video-unread-badge"):document.body.classList.remove("youlag-video-unread-badge")}function setBodyPageClass(){getCurrentPage()&&(document.body.className+=" "+getCurrentPage()),currentPageParams=new URLSearchParams(window.location.search).get("get"),getSubpageParentId(currentPageParams)&&(document.body.className+=" yl-page-"+getSubpageParentId(currentPageParams)),setVideoLabelsClass(),setUnreadBadgeClass(),setCategoryWhitelistClass()}function setVideoLabelsTitle(e,t){if(document.body.classList.contains(e)&&document.body.classList.contains("youlag-video-labels")){const e=document.title.match(/^\s*(\((\d+)\)\s*)?(.+?)\s*¬∑\s*(.+?)\s*$/);if(e){const o=e[1]?e[1]:"",a=e[4]?e[4]:"";document.title=`${o}${t} ¬∑ ${a}`}}}function setupNavMenu(){if(youlagNavMenuInitialized)return;youlagNavMenuInitialized=!0;const e=document.getElementById("yl_nav_menu_container"),t=e?.querySelector("#yl_nav_menu_container_content"),o=e?.querySelector("#yl_nav_menu_container_toggle"),a=document?.querySelector("#dropdown-search-wrapper"),n=document.querySelector("#global nav.nav_menu:not(#yl_nav_menu_container)"),i=document.querySelector("#new-article + .transition");if(!(e&&t&&o&&n&&i)){const a=[];return e||a.push("ylNavMenuContainer"),t||a.push("ylNavMenu"),o||a.push("ylNavMenuToggle"),n||a.push("freshRssNavMenu"),i||a.push("freshRssTransition"),void console.warn("Failed to setup sticky nav menu, missing elements:",a)}if(t.hidden=!0,t.classList.add("nav_menu"),i.classList.add("yl-freshrss-transition--sticky"),e.classList.add("yl-nav-menu-container--sticky"),a&&e.nextSibling&&e.parentNode.insertBefore(a,e.nextSibling),i.appendChild(o),i.nextSibling?i.parentNode.insertBefore(e,i.nextSibling):i.parentNode.appendChild(e),n&&t){Array.from(n.children).forEach(e=>{"nav_menu_toggle_aside"!==e.id&&t.appendChild(e)});const e=document.createElement("div");e.id="yl_nav_menu_settings_shortcut",e.innerHTML='<a href="/i/?c=extension&a=configure&e=Youlag" class="btn" target="_blank" rel="noopener noreferrer">\n                                    More settings\n                                  </a>',t.appendChild(e)}setupNavMenuStickyScroll(i,e),document.addEventListener("click",function(o){if(o.target.closest("#yl_nav_menu_container_toggle")&&document.body.contains(e)){const a=e.classList.toggle("yl-nav-menu-container--open");t.hidden=!a,o.preventDefault(),o.stopPropagation()}})}function setupNavMenuStickyScroll(e,t){let o=window.scrollY,a=!1,n=!1;function i(o){if(disableStickyTransitionTitle)return;const a=e=>{e.classList.toggle("sticky-visible",o),e.classList.toggle("sticky-hidden",!o)};a(e),a(t)}function l(e){const t=document.getElementById("nav_menu_toggle_aside");t&&(t.classList.toggle("sticky-visible--sidenav-toggle",e),t.classList.toggle("sticky-hidden--sidenav-toggle",!e))}window.addEventListener("scroll",function(){a||(window.requestAnimationFrame(()=>{!function(){if(n)return n=!1,void(o=window.scrollY);const e=window.scrollY;e<=0?(i(!0),l(!0)):e>o+2?(i(!1),l(!1)):e<o-2&&(i(!0),l(!0)),o=e}(),a=!1}),a=!0)});new MutationObserver(()=>{n=!0}).observe(t,{attributes:!0,attributeFilter:["class"]})}function clearPathHash(){window.location.hash&&history.replaceState(null,"",window.location.pathname+window.location.search)}function init(){clearPathHash(),setBodyPageClass(),setupClickListener(),setupTagsDropdownOverride(),setTimeout(()=>{youlagSettingsPageEventListeners()},1500),setupNavMenu(),restoreVideoQueue(),setVideoLabelsTitle("yl-page-playlists","Playlists"),setVideoLabelsTitle("yl-page-watch_later","Watch later"),removeYoulagLoadingState(),youlagScriptLoaded=!0}function removeYoulagLoadingState(){document.body.classList.add("youlag-loaded")}function initFallback(){"complete"===document.readyState||"interactive"===document.readyState||!0===youlagScriptLoaded?init():(document.addEventListener("DOMContentLoaded",init),window.addEventListener("load",init))}const checkInitInterval=setInterval(()=>{"complete"!==document.readyState&&!0!==youlagScriptLoaded||(init(),clearInterval(checkInitInterval))},1e3);initFallback();